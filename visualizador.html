<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Visualizar Pedidos - Walterscheid Powertrain Group</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <!-- Cabeçalho -->
    <header>
      <nav>
        <div id="title">
          <h1>Walterscheid Powertrain Group</h1>
        </div>
        <ul>
          <li><a href="index.html">Home</a></li>
          <li><a href="gerador.html">Gerar Pedido</a></li>
          <li><a href="atualizar.html">Atualizar Pedidos</a></li>
          <li><a href="relatorio.html">Relatório</a></li>
        </ul>
      </nav>
    </header>

    <!-- Conteúdo Principal -->
    <main>
      <section class="visualizador-section">
        <h1>Visualizar Pedidos</h1>
        <table id="pedidoTable">
          <thead>
            <tr>
              <th>ID</th>
              <th>Item</th>
              <th>Quantidade</th>
              <th>Parceiro de Negócio</th>
              <th>Status</th>
              <th>Data de Entrada</th>
            </tr>
          </thead>
          <tbody>
            <!-- Os pedidos serão inseridos aqui via JavaScript -->
          </tbody>
        </table>
      </section>
    </main>

    <!-- Rodapé -->
    <footer>
      <div class="footer-logo">
        <img
          src="components/images/Walterscheid.jpg"
          alt="Logo Walterscheid"
          class="logo"
        />
      </div>
      <p>&copy; 2024 Walterscheid. Todos os direitos reservados.</p>
    </footer>

    <script>
      const formID = "66f5a99aea4c280008f95347";
      const token = "nfp_EerkRmRLGWFpi3CudwvneoPcsx1ayxp2b3f5";

      function fetchPedidos() {
        fetch(`https://api.netlify.com/api/v1/forms/${formID}/submissions`, {
          headers: {
            Authorization: `Bearer ${token}`,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            const tabela = document
              .getElementById("pedidoTable")
              .querySelector("tbody");
            tabela.innerHTML = "";

            data.forEach((pedido, index) => {
              const novaLinha = tabela.insertRow();
              novaLinha.innerHTML = `
                        <td>${index + 1}</td>
                        <td>${pedido.data.item}</td>
                        <td>${pedido.data.quantidade}</td>
                        <td>${pedido.data.parceiro}</td>
                        <td>${pedido.data.status || "Não Liberado"}</td>
                        <td>${new Date(pedido.created_at).toLocaleString()}</td>
                    `;
            });
          })
          .catch((error) => console.error("Erro ao buscar pedidos:", error));
      }

      window.onload = function () {
        fetchPedidos();
      };
    </script>
  </body>
</html>
